def getGitCommit() {
  return sh(returnStdout: true, script: 'git rev-parse HEAD').trim()
}

pipeline {
  agent any

  triggers {
    pollSCM('* * * * *')
  }

  stages {
    stage("Apply OC Build-Time things") {
      steps {
        dir("component-1") {
          echo "oc apply -f oc-manifests/build-time/"
          sh "ls"
          sh "pwd"
        }
      }
    }

    stage('Tests') {
      steps {
        parallel (
          "Unit Tests": {
            dir("component-1") {
              echo 'done'
            }
          },
          "Function Tests": {
            dir("component-1") {
              echo 'done'
            }
          },
          "Urine Tests": {
            dir("component-1") {
              sh "cat pipelines/build/Jenkinsfile"
            }
          }
        )
      }
    }

    stage("Deployment"){
      steps {
        sh "env"
        echo getGitCommit()
/*        build( job: "myproject-component-1-deploy-pipeline", wait: true)
        openshiftBuild(
          buildName: "component-1-deploy-pieline",
          commitID: "${env.GIT_COMMIT}"
        )*/
      }
    }
  }
}
